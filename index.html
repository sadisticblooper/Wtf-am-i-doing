<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SF3 Animation Visualizer & Compiler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #111827; color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Main Layout */
        .app-body { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 300px; background-color: #1f2937; border-right: 1px solid #374151; display: flex; flex-direction: column; z-index: 10; }
        .viewport { flex: 1; position: relative; background: linear-gradient(to bottom, #111827, #000); }
        
        /* Header */
        .sidebar-header { padding: 20px; border-bottom: 1px solid #374151; }
        .app-title { font-size: 20px; font-weight: bold; color: #10b981; display: flex; align-items: center; gap: 10px; }
        
        /* Controls */
        .sidebar-content { padding: 20px; flex: 1; overflow-y: auto; }
        .section-title { font-size: 12px; font-weight: 600; color: #9ca3af; text-transform: uppercase; margin-bottom: 10px; display: block; }
        
        .file-drop { border: 2px dashed #4b5563; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; margin-bottom: 20px; }
        .file-drop:hover { border-color: #10b981; background: rgba(16,185,129,0.05); }
        .file-name { display: block; margin-top: 8px; font-size: 13px; color: #d1d5db; word-break: break-all; }
        
        .control-group { margin-bottom: 20px; background: #28303f; padding: 15px; border-radius: 6px; }
        .play-btn { width: 100%; padding: 10px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .play-btn.play { background: #10b981; color: white; }
        .play-btn.pause { background: #ef4444; color: white; }
        
        input[type="range"] { width: 100%; margin: 10px 0; accent-color: #10b981; }
        .range-labels { display: flex; justify-content: space-between; font-size: 11px; color: #9ca3af; }

        /* Footer Bar */
        .footer-bar { height: 60px; background-color: #1f2937; border-top: 1px solid #374151; display: flex; align-items: center; justify-content: flex-end; padding: 0 20px; gap: 15px; }
        
        .btn-footer { padding: 8px 16px; border-radius: 4px; border: 1px solid #374151; background: #374151; color: #e5e7eb; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-footer:hover:not(:disabled) { background: #4b5563; transform: translateY(-1px); }
        .btn-footer:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #10b981; border-color: #10b981; color: white; }
        .btn-primary:hover:not(:disabled) { background: #059669; }

        .hidden-input { display: none; }
        
        /* Status Overlays */
        .status-toast { position: absolute; bottom: 80px; right: 20px; background: #1f2937; padding: 12px 20px; border-radius: 6px; border-left: 4px solid #10b981; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transform: translateX(120%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .status-toast.show { transform: translateX(0); }
        .status-toast.error { border-left-color: #ef4444; }
        
        .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 50; display: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid #374151; border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="app-body">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="app-title"><i class="fas fa-bone"></i> SF3 Visualizer</div>
            </div>
            <div class="sidebar-content">
                <span class="section-title">Source File</span>
                <div class="file-drop" id="dropZone">
                    <i class="fas fa-file-import fa-2x" style="color:#6b7280"></i>
                    <span class="file-name" id="fileName">Load .bytes or .gltf</span>
                    <input type="file" id="mainFileInput" class="hidden-input" accept=".bytes,.bin,.dat,.anim,.gltf,.glb">
                </div>

                <span class="section-title">Playback</span>
                <div class="control-group">
                    <button id="playBtn" class="play-btn play"><i class="fas fa-play"></i> Play</button>
                    <div style="margin-top: 15px;">
                        <div class="range-labels"><span>Frame</span><span id="frameDisplay">0/0</span></div>
                        <input type="range" id="timeline" min="0" value="0" step="1">
                    </div>
                    <div style="margin-top: 10px;">
                        <div class="range-labels"><span>Speed</span><span id="speedDisplay">30 FPS</span></div>
                        <input type="range" id="speed" min="1" max="120" value="30">
                    </div>
                </div>

                <span class="section-title">Info</span>
                <div class="control-group" style="font-size: 12px; color: #9ca3af;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>Bones:</span> <span id="boneCount">0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span>Total Frames:</span> <span id="totalFrames">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Viewport -->
        <div class="viewport" id="canvasContainer">
            <div class="loading-overlay" id="loader">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Footer Actions -->
    <div class="footer-bar">
        <input type="file" id="gltfInput" class="hidden-input" accept=".gltf,.glb">
        
        <button id="btnImportGltf" class="btn-footer">
            <i class="fas fa-file-import"></i> Import GLTF
        </button>
        
        <button id="btnExportGltf" class="btn-footer" disabled>
            <i class="fas fa-cube"></i> Export GLTF
        </button>
        
        <div style="width: 1px; height: 30px; background: #374151; margin: 0 10px;"></div>

        <button id="btnCompile" class="btn-footer btn-primary" disabled>
            <i class="fas fa-file-code"></i> Compile (.bytes)
        </button>
    </div>

    <div id="toast" class="status-toast">Ready</div>

    <!-- Dependencies -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/examples/": "https://unpkg.com/three@0.160.0/examples/"
            }
        }
    </script>

    <!-- Modules -->
    <script type="module" src="./app.js"></script>
</body>
</html>
